datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id          Int               @id @default(autoincrement())
  externalId  String            @unique @default(uuid()) @map("external_id")
  username    String            @unique
  email       String            @unique
  password    String
  preferences UserPreferences[]

  plans             Plan[]
  userPreferencesId Int?

  @@map("users")
}

model UserPreferences {
  id            Int    @id @default(autoincrement())
  externalId    String @unique @default(uuid()) @map("external_id")
  userId        Int
  preferencesId Int

  preference Preferences @relation(fields: [preferencesId], references: [id])
  user       User        @relation(fields: [userId], references: [id])

  @@map("user_preferences")
}

model Preferences {
  id              Int               @id @default(autoincrement())
  externalId      String            @unique @default(uuid()) @map("external_id")
  name            String
  UserPreferences UserPreferences[]
}

model Plan {
  id            Int      @id @default(autoincrement())
  externalId    String   @unique @default(uuid()) @map("external_id")
  destination   String
  country       String
  description   String
  startDate     DateTime
  endDate       DateTime
  spendingLevel String
  hosting       Boolean
  latitude      Decimal
  longitude     Decimal
  userId        Int      @map("user_id")

  user       User              @relation(fields: [userId], references: [id])
  activities TouristActivity[]
  TripDay    TripDay[]

  @@map("plans")
}

model TouristActivity {
  id          Int     @id @default(autoincrement())
  externalId  String  @unique @default(uuid()) @map("external_id")
  name        String
  description String
  latitude    Decimal
  longitude   Decimal
  photoPath   String? @map("photo_path")
  planId      Int     @map("plan_id")

  plan      Plan     @relation(fields: [planId], references: [id])
  TripDay   TripDay? @relation(fields: [tripDayId], references: [id])
  tripDayId Int?

  @@map("tourist_spots")
}

model TripDay {
  id         Int               @id @default(autoincrement())
  date       DateTime
  planId     Int               @map("plan_id")
  plan       Plan              @relation(fields: [planId], references: [id])
  activities TouristActivity[]

  @@map("trip_days")
}
